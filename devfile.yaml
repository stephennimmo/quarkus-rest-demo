schemaVersion: 2.2.0
metadata:
  name: quarkus-rest-demo-ubi9
  version: 1.3.0
  displayName: Quarkus REST Demo (Red Hat Java 21)
  description: Fixed Dev environment to avoid SIGKILL on startup.
  tags: ["Red Hat", "UBI9", "Java 21", "Quarkus"]
  projectType: "Quarkus"
  language: "Java"

components:
  - name: java-quarkus
    container:
      image: registry.access.redhat.com/ubi9/openjdk-21:latest
      memoryLimit: 3G
      mountSources: true
      endpoints:
        - name: http-quarkus
          targetPort: 8080
        - name: debug
          targetPort: 5005
          exposure: internal
      env:
        - name: MAVEN_OPTS
          value: "-Xmx1536M -XX:+UseParallelGC"
        - name: HOME
          value: /home/jboss

commands:
  - id: install-dependencies
    exec:
      label: "1. Install Dependencies (Run once)"
      component: java-quarkus
      workingDir: ${PROJECT_SOURCE}
      # This command only downloads dependencies without running tests/builds
      commandLine: "./mvnw dependency:go-offline"
      group:
        kind: build

  - id: dev
    exec:
      label: "2. Run Quarkus Dev Mode"
      component: java-quarkus
      workingDir: ${PROJECT_SOURCE}
      commandLine: "./mvnw quarkus:dev -Dmaven.compiler.release=21"
      group:
        kind: run
        isDefault: true

  - id: build
    exec:
      label: "Build Application"
      component: java-quarkus
      workingDir: ${PROJECT_SOURCE}
      commandLine: "./mvnw clean package -DskipTests -Dmaven.compiler.release=21"
      group:
        kind: build

# Removed 'events' section to prevent startup timeout